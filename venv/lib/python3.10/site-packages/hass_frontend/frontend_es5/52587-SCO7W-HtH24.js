"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[52587],{52587:function(e,t,n){n.r(t),n.d(t,{ExternalAuth:function(){return m},createExternalAuth:function(){return v}});var r=n(99312),o=n(81043),s=n(71650),i=n(33368);function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var u=n(76775);function l(e,t){if(t&&("object"===(0,u.Z)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}var f=n(40788),p=function(){function e(){(0,s.Z)(this,e),this.config=void 0,this.commands={},this.msgId=0,this._commandHandler=void 0}var t;return(0,i.Z)(e,[{key:"attach",value:(t=(0,o.Z)((0,r.Z)().mark((function e(){var t=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.externalBus=function(e){return t.receiveMessage(e)},window.addEventListener("connection-status",(function(e){return t.fireMessage({type:"connection-status",payload:{event:e.detail}})})),e.next=4,this.sendMessage({type:"config/get"});case 4:this.config=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"addCommandHandler",value:function(e){this._commandHandler=e}},{key:"sendMessage",value:function(e){var t=this,n=++this.msgId;return e.id=n,this._sendExternal(e),new Promise((function(e,r){t.commands[n]={resolve:e,reject:r}}))}},{key:"fireMessage",value:function(e){e.id||(e.id=++this.msgId),this._sendExternal(e)}},{key:"receiveMessage",value:function(e){if("command"!==e.type){var t=this.commands[e.id];t?"result"===e.type&&(e.success?t.resolve(e.result):t.reject(e.error)):console.warn("Received unknown msg ID",e.id)}else{var n,r;this._commandHandler&&this._commandHandler(e)||(this._commandHandler?(n="not_ready",r="Command handler not ready"):(n="unknown_command",r="Unknown command ".concat(e.command)),console.warn(r,e),this.fireMessage({id:e.id,type:"result",success:!1,error:{code:n,message:r}}))}}},{key:"_sendExternal",value:function(e){window.externalApp?window.externalApp.externalBus(JSON.stringify(e)):window.webkit.messageHandlers.externalBus.postMessage(e)}}]),e}(),w="externalAuthSetToken",h="externalAuthRevokeToken";if(!window.externalApp&&!window.webkit)throw new Error("External auth requires either externalApp or webkit defined on Window object.");var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t,n,c=d(u);function u(e){var t;return(0,s.Z)(this,u),(t=c.call(this,{hassUrl:e,clientId:"",refresh_token:"",access_token:"",expires_in:0,expires:0})).external=void 0,t._tokenCallbackPromise=void 0,t}return(0,i.Z)(u,[{key:"refreshAccessToken",value:(n=(0,o.Z)((0,r.Z)().mark((function e(t){var n,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._tokenCallbackPromise||t){e.next=10;break}return e.prev=1,e.next=4,this._tokenCallbackPromise;case 4:return e.abrupt("return");case 7:e.prev=7,e.t0=e.catch(1),this._tokenCallbackPromise=void 0;case 10:return n={callback:w},t&&(n.force=!0),this._tokenCallbackPromise=new Promise((function(e,t){window[w]=function(n,r){return n?e(r):t(r)}})),e.next=15,Promise.resolve();case 15:return window.externalApp?window.externalApp.getExternalAuth(JSON.stringify(n)):window.webkit.messageHandlers.getExternalAuth.postMessage(n),e.next=18,this._tokenCallbackPromise;case 18:o=e.sent,this.data.access_token=o.access_token,this.data.expires=1e3*o.expires_in+Date.now(),this._tokenCallbackPromise=void 0;case 22:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return n.apply(this,arguments)})},{key:"revoke",value:(t=(0,o.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={callback:h},n=new Promise((function(e,t){window[h]=function(n,r){return n?e(r):t(r)}})),e.next=4,Promise.resolve();case 4:return window.externalApp?window.externalApp.revokeExternalAuth(JSON.stringify(t)):window.webkit.messageHandlers.revokeExternalAuth.postMessage(t),e.next=7,n;case 7:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),u}(f.gx),v=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){var n,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new m(t),!(null!==(n=window.externalApp)&&void 0!==n&&n.externalBus||window.webkit&&window.webkit.messageHandlers.externalBus)){e.next=5;break}return o.external=new p,e.next=5,o.external.attach();case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=52587-SCO7W-HtH24.js.map