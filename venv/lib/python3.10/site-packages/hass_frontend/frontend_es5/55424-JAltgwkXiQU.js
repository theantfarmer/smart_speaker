"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[55424],{72043:function(e,t,n){n.d(t,{A:function(){return u}});var r=n(23158),o=n(25101),i=n(66477),u=function(e,t,n,u,a){return n.time_zone===i.c_.server?function(e,t,n,i){var u=n((0,r.Z)(e,t),i);return(0,o.Z)(u,t)}(e,u.time_zone,t,a):t(e,a)}},92306:function(e,t,n){n.d(t,{v:function(){return o}});var r=n(40039),o=function(e,t){var n,o={},i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var u=n.value,a=t(u);a in o?o[a].push(u):o[a]=[u]}}catch(s){i.e(s)}finally{i.f()}return o}},81582:function(e,t,n){if(n.d(t,{DJ:function(){return u},LZ:function(){return o},Nn:function(){return l},Ny:function(){return _},Pk:function(){return g},Q4:function(){return i},RQ:function(){return s},SO:function(){return c},T0:function(){return y},iJ:function(){return f},pB:function(){return a}}),32143==n.j)var r=n(53709);var o=32143==n.j?["migration_error","setup_error","setup_retry"]:null,i=32143==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,u=function(e,t,n){var r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((function(e){return t(e)}),r)},a=function(e,t){var n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS(Object.assign({type:"config_entries/get"},n))},s=function(e,t){return e.callWS({type:"config_entries/get_single",entry_id:t})},c=function(e,t,n){return e.callWS(Object.assign({type:"config_entries/update",entry_id:t},n))},f=function(e,t){return e.callApi("DELETE","config/config_entries/entry/".concat(t))},l=function(e,t){return e.callApi("POST","config/config_entries/entry/".concat(t,"/reload"))},_=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"})},y=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null})},g=function(e,t){var n=(0,r.Z)(e),o=function(e){var n=t[e.domain];return"helper"===(null==n?void 0:n.integration_type)?-1:1};return n.sort((function(e,t){return o(t)-o(e)}))}},55424:function(e,t,n){n.d(t,{Bm:function(){return T},Cj:function(){return C},G9:function(){return N},Jj:function(){return B},KU:function(){return W},P:function(){return P},UB:function(){return K},ZC:function(){return E},_Z:function(){return A},b:function(){return U},gy:function(){return O},iK:function(){return j},jB:function(){return z},o1:function(){return S},rl:function(){return x},vE:function(){return Q},xZ:function(){return D},yH:function(){return M}});var r,o,i=n(53709),u=n(68990),a=n(40039),s=n(99312),c=n(81043),f=n(24112),l=n(32182),_=n(79021),y=n(39244),g=n(59429),p=n(93752),d=n(59699),m=n(97330),v=n(72043),h=n(49684),b=n(92306),Z=n(81582),w=n(38014),k=[],T=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},S=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},j=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},x=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},P=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},W=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},C=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},D=function(e){return e.callWS({type:"energy/info"})},O=32143==n.j?(r=(0,c.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",t.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}):null,E=function(e){return e.callWS({type:"energy/get_prefs"})},A=32143==n.j?(o=(0,c.Z)((0,s.Z)().mark((function e(t,n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.callWS(Object.assign({type:"energy/save_prefs"},n)),J(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)}):null,L=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,r,o,i){var u,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=a.length>5&&void 0!==a[5]?a[5]:"hour",e.abrupt("return",t.callWS({type:"energy/fossil_energy_consumption",start_time:n.toISOString(),end_time:null==i?void 0:i.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:u}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),B=function(e){return(0,b.v)(e.energy_sources,(function(e){return e.type}))},M=function(e,t,n){var r,o=[],i=(0,a.Z)(e.energy_sources);try{for(i.s();!(r=i.n()).done;){var u=r.value;if(!n||n.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var s,c=(0,a.Z)(u.flow_from);try{for(c.s();!(s=c.n()).done;){var f=s.value;o.push(f.stat_energy_from),f.stat_cost&&o.push(f.stat_cost);var l=t.cost_sensors[f.stat_energy_from];l&&o.push(l)}}catch(m){c.e(m)}finally{c.f()}var _,y=(0,a.Z)(u.flow_to);try{for(y.s();!(_=y.n()).done;){var g=_.value;o.push(g.stat_energy_to),g.stat_compensation&&o.push(g.stat_compensation);var p=t.cost_sensors[g.stat_energy_to];p&&o.push(p)}}catch(m){y.e(m)}finally{y.f()}}else o.push(u.stat_energy_from),o.push(u.stat_energy_to);else{o.push(u.stat_energy_from),u.stat_cost&&o.push(u.stat_cost);var d=t.cost_sensors[u.stat_energy_from];d&&o.push(d)}else o.push(u.stat_energy_from)}}catch(m){i.e(m)}finally{i.f()}return o},H=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,r,o,c){var g,p,d,m,v,h,b,k,T,S,j,x,P,W,C,O,E,A,B,H,J,K,z,I,N,Q,U,G,R,q,F,V,X,Y,$,ee,te,ne,re,oe,ie,ue,ae,se,ce,fe,le;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,Z.pB)(t,{domain:"co2signal"}),D(t)]);case 2:if(g=e.sent,p=(0,u.Z)(g,2),d=p[0],m=p[1],!(v=d.length?d[0]:void 0)){e.next=21;break}b=0,k=Object.values(t.entities);case 9:if(!(b<k.length)){e.next=21;break}if("co2signal"===(T=k[b]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((S=t.states[T.entity_id])&&"%"===S.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return h=S.entity_id,e.abrupt("break",21);case 18:b++,e.next=9;break;case 21:j=[],x=(0,a.Z)(n.energy_sources);try{for(x.s();!(P=x.n()).done;)if("grid"===(W=P.value).type){C=(0,a.Z)(W.flow_from);try{for(C.s();!(O=C.n()).done;)E=O.value,j.push(E.stat_energy_from)}catch(s){C.e(s)}finally{C.f()}}}catch(s){x.e(s)}finally{x.f()}return A=M(n,m,["grid","solar","battery","gas"]),B=M(n,m,["water"]),H=[].concat((0,i.Z)(A),(0,i.Z)(B)),J=(0,f.Z)(o||new Date,r),K=J>35?"month":J>2?"day":"hour",z=t.config.unit_system.length||"",I={energy:"kWh",volume:"km"===z?"m³":"ft³"},N={volume:"km"===z?"L":"gal"},Q=A.length?(0,w.dL)(t,r,o,A,K,I,["change"]):{},U=B.length?(0,w.dL)(t,r,o,B,K,N,["change"]):{},F={},V={},c&&(R=J>27&&J<32?(0,l.Z)(r,-1):(0,_.Z)(r,-1*(J+1)),q=(0,y.Z)(r,-1),A.length&&(F=(0,w.dL)(t,R,q,A,K,I,["change"])),B.length&&(V=(0,w.dL)(t,R,q,B,K,N,["change"]))),void 0!==h&&(X=L(t,r,j,h,o,J>35?"month":J>2?"day":"hour"),c&&(Y=L(t,R,j,h,q,J>35?"month":J>2?"day":"hour"))),$={},ee=H.length?(0,w.Py)(t,H):[],e.next=42,Promise.all([Q,U,F,V,ee,X,Y]);case 42:return te=e.sent,ne=(0,u.Z)(te,7),re=ne[0],oe=ne[1],ie=ne[2],ue=ne[3],ae=ne[4],se=ne[5],ce=ne[6],fe=Object.assign(Object.assign({},re),oe),c&&(G=Object.assign(Object.assign({},ie),ue)),H.length&&ae.forEach((function(e){$[e.statistic_id]=e})),le={start:r,end:o,startCompare:R,endCompare:q,info:m,prefs:n,stats:fe,statsMetadata:$,statsCompare:G,co2SignalConfigEntry:v,co2SignalEntity:h,fossilEnergyConsumption:se,fossilEnergyConsumptionCompare:ce},e.abrupt("return",le);case 56:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),J=function(e){k.forEach((function(t){var n=K(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n="_".concat(t.key)}if(e.connection[n])return e.connection[n];k.push(t.key);var r=(0,m._)(e.connection,n,(0,c.Z)((0,s.Z)().mark((function t(){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.prefs){t.next=4;break}return t.next=3,E(e);case 3:r.prefs=t.sent;case 4:return r._refreshTimeout&&clearTimeout(r._refreshTimeout),r._active&&(!r.end||r.end>new Date)&&((n=new Date).getMinutes()>=20&&n.setHours(n.getHours()+1),n.setMinutes(20,0,0),r._refreshTimeout=window.setTimeout((function(){return r.refresh()}),n.getTime()-Date.now())),t.abrupt("return",H(e,r.prefs,r.start,r.end,r.compare));case 7:case"end":return t.stop()}}),t)})))),o=r.subscribe;r.subscribe=function(e){var t=o(e);return r._active++,function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;var i=new Date,u=(0,h.Zs)(i,e.locale,e.config).split(":")[0];r.start=(0,v.A)("0"===u?(0,_.Z)(i,-1):i,g.Z,e.locale,e.config),r.end=(0,v.A)("0"===u?(0,_.Z)(i,-1):i,p.Z,e.locale,e.config);var a=function t(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,v.A)(new Date,g.Z,e.locale,e.config),r.end=(0,v.A)(new Date,p.Z,e.locale,e.config),t()}),(0,d.Z)((0,v.A)(i,p.Z,e.locale,e.config),1).getTime()-Date.now())};return a(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(t,n){var o;r.start=t,r.end=n,r.start.getTime()!==(0,v.A)(new Date,g.Z,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,v.A)(new Date,p.Z,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=function(e){r.compare=e},r},z=function(e){return e.callWS({type:"energy/solar_forecast"})},I=["volume","energy"],N=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,a.Z)(e.energy_sources);try{for(o.s();!(t=o.n()).done;){var i=t.value;if("gas"===i.type&&(!r||r!==i.stat_energy_from)){var u=n[i.stat_energy_from];if(I.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(s){o.e(s)}finally{o.f()}},Q=function(e,t){var n=N(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m³":"ft³"},U=function(e){return"km"===e.config.unit_system.length?"L":"gal"}}}]);
//# sourceMappingURL=55424-JAltgwkXiQU.js.map