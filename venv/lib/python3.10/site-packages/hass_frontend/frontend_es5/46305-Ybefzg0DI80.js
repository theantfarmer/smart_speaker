"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[46305],{76680:function(t,e,i){function a(t){return void 0===t||Array.isArray(t)?t:[t]}i.d(e,{r:function(){return a}})},85157:function(t,e,i){i.d(e,{t:function(){return o}});var a=i(71650),n=i(33368),r=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.localStorage;(0,a.Z)(this,t),this.storage=void 0,this._storage={},this._listeners={},this.storage=i,i===window.localStorage&&window.addEventListener("storage",(function(t){t.key&&e.hasKey(t.key)&&(e._storage[t.key]=t.newValue?JSON.parse(t.newValue):t.newValue,e._listeners[t.key]&&e._listeners[t.key].forEach((function(i){return i(t.oldValue?JSON.parse(t.oldValue):t.oldValue,e._storage[t.key])})))}))}return(0,n.Z)(t,[{key:"addFromStorage",value:function(t){if(!this._storage[t]){var e=this.storage.getItem(t);e&&(this._storage[t]=JSON.parse(e))}}},{key:"subscribeChanges",value:function(t,e){var i=this;return this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e],function(){i.unsubscribeChanges(t,e)}}},{key:"unsubscribeChanges",value:function(t,e){if(t in this._listeners){var i=this._listeners[t].indexOf(e);-1!==i&&this._listeners[t].splice(i,1)}}},{key:"hasKey",value:function(t){return t in this._storage}},{key:"getValue",value:function(t){return this._storage[t]}},{key:"setValue",value:function(t,e){var i=this._storage[t];this._storage[t]=e;try{void 0===e?this.storage.removeItem(t):this.storage.setItem(t,JSON.stringify(e))}catch(a){}finally{this._listeners[t]&&this._listeners[t].forEach((function(t){return t(i,e)}))}}}]),t}(),s={},o=function(t){return function(e){var i,a=t.storage||"localStorage";a&&a in s?i=s[a]:(i=new r(window[a]),s[a]=i);var n=String(e.key),o=t.key||String(e.key),d=e.initializer?e.initializer():void 0;i.addFromStorage(o);var l=!1!==t.subscribe?function(t){return i.subscribeChanges(o,(function(i,a){t.requestUpdate(e.key,i)}))}:void 0,u=function(){return i.hasKey(o)?i.getValue(o):d};return{kind:"method",placement:"prototype",key:e.key,descriptor:{set:function(a){!function(a,n){var r;t.state&&(r=u()),i.setValue(o,n),t.state&&a.requestUpdate(e.key,r)}(this,a)},get:function(){return u()},enumerable:!0,configurable:!0},finisher:function(i){if(t.state&&t.subscribe){var a=i.prototype.connectedCallback,r=i.prototype.disconnectedCallback;i.prototype.connectedCallback=function(){a.call(this),this["__unbsubLocalStorage".concat(n)]=null==l?void 0:l(this)},i.prototype.disconnectedCallback=function(){var t;r.call(this),null===(t=this["__unbsubLocalStorage".concat(n)])||void 0===t||t.call(this),this["__unbsubLocalStorage".concat(n)]=void 0}}t.state&&i.createProperty(e.key,Object.assign({noAccessor:!0},t.stateOptions))}}}}},50239:function(t,e,i){i.d(e,{Y:function(){return n},u:function(){return a}});var a=function(t,e,i){return Math.min(Math.max(t,e),i)},n=function(t,e,i){var a;return a=e?Math.max(t,e):t,a=i?Math.min(a,i):a}},39258:function(t,e,i){i.d(e,{U:function(){return v}});var a=i(55070),n=i(15838),r=i(89525),s=i(58831),o=i(6229),d=i(56007),l=i(22134),u={media_player:{paused:.5,idle:1},vacuum:{returning:.5}};var c=0,h=new Map;function v(t,e,i){return function(t,e,i){var a;if(!i||t===d.nZ)return(0,l.g)("--history-unavailable-color",e);if(t===d.lz)return(0,l.g)("--history-unknown-color",e);var c=(0,o.tD)(i,t);if(c){var h=(0,l.g)(c,e);if(h){var v=(0,s.M)(i.entity_id),_=null===(a=u[v])||void 0===a?void 0:a[t];return _?(0,n.uO)((0,r.C)((0,n.Rw)((0,n.wK)(h)),_)):h}}}(t,e,i)||function(t,e){if(h.has(t))return h.get(t);var i=(0,a.hZ)(c,e);return c++,h.set(t,i),i}(t,e)}},31206:function(t,e,i){i.r(e),i.d(e,{HaCircularProgress:function(){return k}});var a,n=i(88962),r=i(33368),s=i(71650),o=i(82390),d=i(69205),l=i(70906),u=i(91808),c=i(34541),h=i(47838),v=i(30879),_=i(68144),f=i(79932),k=(0,u.Z)([(0,f.Mo)("ha-circular-progress")],(function(t,e){var i=function(e){(0,d.Z)(a,e);var i=(0,l.Z)(a);function a(){var e;(0,s.Z)(this,a);for(var n=arguments.length,r=new Array(n),d=0;d<n;d++)r[d]=arguments[d];return e=i.call.apply(i,[this].concat(r)),t((0,o.Z)(e)),e}return(0,r.Z)(a)}(e);return{F:i,d:[{kind:"field",decorators:[(0,f.Cb)({type:Boolean})],key:"active",value:function(){return!1}},{kind:"field",decorators:[(0,f.Cb)()],key:"alt",value:function(){return"Loading"}},{kind:"field",decorators:[(0,f.Cb)()],key:"size",value:function(){return"medium"}},{kind:"set",key:"density",value:function(t){}},{kind:"get",key:"density",value:function(){switch(this.size){case"tiny":return-8;case"small":return-5;case"medium":default:return 0;case"large":return 5}}},{kind:"set",key:"indeterminate",value:function(t){}},{kind:"get",key:"indeterminate",value:function(){return this.active}},{kind:"get",static:!0,key:"styles",value:function(){return[(0,c.Z)((0,h.Z)(i),"styles",this),(0,_.iv)(a||(a=(0,n.Z)([":host{overflow:hidden}"])))]}}]}}),v.D)},3542:function(t,e,i){i.r(e);var a,n,r,s,o,d,l,u,c=i(53709),h=i(40039),v=i(99312),_=i(81043),f=i(88962),k=i(33368),y=i(71650),g=i(82390),p=i(69205),b=i(70906),m=i(91808),L=i(34541),w=i(47838),Z=i(72277),D=i(68144),V=i(79932),C=i(76680),x=i(85157),P=i(83849),H=i(69934),S=i(15493),E=i(87744),B=i(62336),I=(i(51324),i(31206),i(29272),i(10983),i(2315),i(48932),i(63681),i(36226),i(57066)),M=i(57292),z=i(74186),O=i(58763),A=i(73826),U=i(11654),T=(0,m.Z)(null,(function(t,e){var i,m=function(e){(0,p.Z)(a,e);var i=(0,b.Z)(a);function a(){var e;(0,y.Z)(this,a),e=i.call(this),t((0,g.Z)(e));var n=new Date;n.setHours(n.getHours()-1,0,0,0),e._startDate=n;var r=new Date;return r.setHours(r.getHours()+2,0,0,0),e._endDate=r,e}return(0,k.Z)(a)}(e);return{F:m,d:[{kind:"field",decorators:[(0,V.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,V.Cb)({reflect:!0,type:Boolean})],key:"narrow",value:void 0},{kind:"field",decorators:[(0,V.Cb)({reflect:!0,type:Boolean})],key:"rtl",value:function(){return!1}},{kind:"field",decorators:[(0,V.SB)()],key:"_startDate",value:void 0},{kind:"field",decorators:[(0,V.SB)()],key:"_endDate",value:void 0},{kind:"field",decorators:[(0,x.t)({key:"historyPickedValue",state:!0,subscribe:!1})],key:"_targetPickerValue",value:void 0},{kind:"field",decorators:[(0,V.SB)()],key:"_isLoading",value:function(){return!1}},{kind:"field",decorators:[(0,V.SB)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,V.SB)()],key:"_deviceEntityLookup",value:void 0},{kind:"field",decorators:[(0,V.SB)()],key:"_areaEntityLookup",value:void 0},{kind:"field",decorators:[(0,V.SB)()],key:"_areaDeviceLookup",value:void 0},{kind:"field",decorators:[(0,V.SB)()],key:"_showBack",value:void 0},{kind:"field",decorators:[(0,V.IO)("state-history-charts")],key:"_stateHistoryCharts",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"field",key:"_interval",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,L.Z)((0,w.Z)(m.prototype),"connectedCallback",this).call(this),this.hasUpdated&&this._getHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,L.Z)((0,w.Z)(m.prototype),"disconnectedCallback",this).call(this),this._unsubscribeHistory()}},{kind:"method",key:"hassSubscribe",value:function(){var t=this;return[(0,z.LM)(this.hass.connection,(function(e){t._deviceEntityLookup=(0,M.pI)(e),t._areaEntityLookup=(0,I.TD)(e)})),(0,M.q4)(this.hass.connection,(function(e){t._areaDeviceLookup=(0,I.Dl)(e)}))]}},{kind:"method",key:"_goBack",value:function(){history.back()}},{kind:"method",key:"render",value:function(){return(0,D.dy)(a||(a=(0,f.Z)([" <ha-top-app-bar-fixed> ",' <div slot="title">',"</div> ",' <ha-icon-button slot="actionItems" @click="','" .disabled="','" .path="','" .label="','"></ha-icon-button> <div class="flex content"> <div class="filters"> <ha-date-range-picker .hass="','" ?disabled="','" .startDate="','" .endDate="','" @change="','"></ha-date-range-picker> <ha-target-picker .hass="','" .value="','" .disabled="','" addOnTop @value-changed="','"></ha-target-picker> </div> '," </div> </ha-top-app-bar-fixed> "])),this._showBack?(0,D.dy)(n||(n=(0,f.Z)([' <ha-icon-button-arrow-prev slot="navigationIcon" @click="','"></ha-icon-button-arrow-prev> '])),this._goBack):(0,D.dy)(r||(r=(0,f.Z)([' <ha-menu-button slot="navigationIcon" .hass="','" .narrow="','"></ha-menu-button> '])),this.hass,this.narrow),this.hass.localize("panel.history"),this._targetPickerValue?(0,D.dy)(s||(s=(0,f.Z)([' <ha-icon-button slot="actionItems" @click="','" .disabled="','" .path="','" .label="','"></ha-icon-button> '])),this._removeAll,this._isLoading,"M14.76,20.83L17.6,18L14.76,15.17L16.17,13.76L19,16.57L21.83,13.76L23.24,15.17L20.43,18L23.24,20.83L21.83,22.24L19,19.4L16.17,22.24L14.76,20.83M12,12V19.88C12.04,20.18 11.94,20.5 11.71,20.71C11.32,21.1 10.69,21.1 10.3,20.71L8.29,18.7C8.06,18.47 7.96,18.16 8,17.87V12H7.97L2.21,4.62C1.87,4.19 1.95,3.56 2.38,3.22C2.57,3.08 2.78,3 3,3V3H17V3C17.22,3 17.43,3.08 17.62,3.22C18.05,3.56 18.13,4.19 17.79,4.62L12.03,12H12Z",this.hass.localize("ui.panel.history.remove_all")):"",this._getHistory,this._isLoading||!this._targetPickerValue,"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",this.hass.localize("ui.common.refresh"),this.hass,this._isLoading,this._startDate,this._endDate,this._dateRangeChanged,this.hass,this._targetPickerValue,this._isLoading,this._targetsChanged,this._isLoading?(0,D.dy)(o||(o=(0,f.Z)(['<div class="progress-wrapper"> <ha-circular-progress active alt="','"></ha-circular-progress> </div>'])),this.hass.localize("ui.common.loading")):this._targetPickerValue?(0,D.dy)(l||(l=(0,f.Z)([' <state-history-charts .hass="','" .historyData="','" .startTime="','" .endTime="','"> </state-history-charts> '])),this.hass,this._stateHistory,this._startDate,this._endDate):(0,D.dy)(d||(d=(0,f.Z)(['<div class="start-search"> '," </div>"])),this.hass.localize("ui.panel.history.start_search")))}},{kind:"method",key:"willUpdate",value:function(t){if((0,L.Z)((0,w.Z)(m.prototype),"willUpdate",this).call(this,t),!this.hasUpdated){var e=(0,S.Q2)(),i=e.entity_id,a=e.device_id,n=e.area_id;if((i||a||n)&&(this._targetPickerValue={}),i){var r=i.split(",");this._targetPickerValue.entity_id=r}if(a){var s=a.split(",");this._targetPickerValue.device_id=s}if(n){var o=n.split(",");this._targetPickerValue.area_id=o}var d=e.start_date;d&&(this._startDate=new Date(d));var l=e.end_date;l&&(this._endDate=new Date(l))}}},{kind:"method",key:"firstUpdated",value:function(t){(0,L.Z)((0,w.Z)(m.prototype),"firstUpdated",this).call(this,t),"1"===(0,S.Q2)().back&&history.length>1&&(this._showBack=!0,(0,P.c)((0,H.q)((0,S.pc)("back")),{replace:!0}))}},{kind:"method",key:"updated",value:function(t){if(this._targetPickerValue&&(t.has("_startDate")||t.has("_endDate")||t.has("_targetPickerValue")||!this._stateHistory&&(t.has("_deviceEntityLookup")||t.has("_areaEntityLookup")||t.has("_areaDeviceLookup")))&&this._getHistory(),t.has("hass")||t.has("_entities")){var e=t.get("hass");e&&e.language===this.hass.language||(this.rtl=(0,E.HE)(this.hass))}}},{kind:"method",key:"_removeAll",value:function(){this._targetPickerValue=void 0,this._updatePath()}},{kind:"method",key:"_getHistory",value:(i=(0,_.Z)((0,v.Z)().mark((function t(){var e,i,a=this;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._targetPickerValue){t.next=2;break}return t.abrupt("return");case 2:if(this._isLoading=!0,void 0!==(e=this._getEntityIds())){t.next=8;break}return this._isLoading=!1,this._stateHistory=void 0,t.abrupt("return");case 8:if(0!==e.length){t.next=12;break}return this._isLoading=!1,this._stateHistory={line:[],timeline:[]},t.abrupt("return");case 12:this._subscribed&&this._unsubscribeHistory(),i=new Date,this._subscribed=(0,O.Vk)(this.hass,(function(t){a._isLoading=!1,a._stateHistory=(0,O.Nu)(a.hass,t,a.hass.localize)}),this._startDate,this._endDate,e),this._subscribed.catch((function(){a._isLoading=!1,a._unsubscribeHistory()})),this._endDate>i&&this._setRedrawTimer();case 17:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"_setRedrawTimer",value:function(){var t=this;clearInterval(this._interval);var e=new Date,i=this._endDate>e?e:this._endDate,a=(0,Z.Z)(i,this._startDate);this._interval=window.setInterval((function(){var e;return null===(e=t._stateHistoryCharts)||void 0===e?void 0:e.requestUpdate()}),a<2?1e4:a<10?6e4:B.Q)}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._interval&&(clearInterval(this._interval),this._interval=void 0),this._subscribed&&(this._subscribed.then((function(t){return null==t?void 0:t()})),this._subscribed=void 0)}},{kind:"method",key:"_getEntityIds",value:function(){if(this._targetPickerValue&&void 0!==this._deviceEntityLookup&&void 0!==this._areaEntityLookup&&void 0!==this._areaDeviceLookup){var t=new Set,e=this._targetPickerValue,i=e.area_id,a=e.device_id,n=e.entity_id;if(i){i=(0,C.r)(i);var r,s=(0,h.Z)(i);try{for(s.s();!(r=s.n()).done;){var o=r.value,d=this._areaEntityLookup[o];if(null!=d&&d.length){var l,u=(0,h.Z)(d);try{for(u.s();!(l=u.n()).done;){var v=l.value;null===v.entity_category&&t.add(v.entity_id)}}catch(B){u.e(B)}finally{u.f()}}var _=this._areaDeviceLookup[o];if(null!=_&&_.length){var f,k=(0,h.Z)(_);try{for(k.s();!(f=k.n()).done;){var y=f.value,g=this._deviceEntityLookup[y.id];if(null!=g&&g.length){var p,b=(0,h.Z)(g);try{for(b.s();!(p=b.n()).done;){var m=p.value;m.area_id&&m.area_id!==o||null!==m.entity_category||t.add(m.entity_id)}}catch(B){b.e(B)}finally{b.f()}}}}catch(B){k.e(B)}finally{k.f()}}}}catch(B){s.e(B)}finally{s.f()}}if(a){a=(0,C.r)(a);var L,w=(0,h.Z)(a);try{for(w.s();!(L=w.n()).done;){var Z=L.value,D=this._deviceEntityLookup[Z];if(null!=D&&D.length){var V,x=(0,h.Z)(D);try{for(x.s();!(V=x.n()).done;){var P=V.value;null===P.entity_category&&t.add(P.entity_id)}}catch(B){x.e(B)}finally{x.f()}}}}catch(B){w.e(B)}finally{w.f()}}if(n){n=(0,C.r)(n);var H,S=(0,h.Z)(n);try{for(S.s();!(H=S.n()).done;){var E=H.value;t.add(E)}}catch(B){S.e(B)}finally{S.f()}}return(0,c.Z)(t)}}},{kind:"method",key:"_dateRangeChanged",value:function(t){this._startDate=t.detail.startDate;var e=t.detail.endDate;0===e.getHours()&&0===e.getMinutes()&&(e.setDate(e.getDate()+1),e.setMilliseconds(e.getMilliseconds()-1)),this._endDate=e,this._updatePath()}},{kind:"method",key:"_targetsChanged",value:function(t){this._targetPickerValue=t.detail.value,this._updatePath()}},{kind:"method",key:"_updatePath",value:function(){var t={};this._targetPickerValue&&(this._targetPickerValue.entity_id&&(t.entity_id=(0,C.r)(this._targetPickerValue.entity_id).join(",")),this._targetPickerValue.area_id&&(t.area_id=(0,C.r)(this._targetPickerValue.area_id).join(",")),this._targetPickerValue.device_id&&(t.device_id=(0,C.r)(this._targetPickerValue.device_id).join(","))),this._startDate&&(t.start_date=this._startDate.toISOString()),this._endDate&&(t.end_date=this._endDate.toISOString()),(0,P.c)("/history?".concat((0,S.ou)(t)),{replace:!0})}},{kind:"get",static:!0,key:"styles",value:function(){return[U.Qx,(0,D.iv)(u||(u=(0,f.Z)([".content{padding:0 16px 16px;padding-bottom:max(env(safe-area-inset-bottom),16px)}:host([virtualize]){height:100%}.progress-wrapper{position:relative;display:flex;align-items:center;flex-direction:column;padding:16px}.filters{display:flex;align-items:flex-start;margin-top:16px}ha-date-range-picker{margin-right:16px;margin-inline-end:16px;margin-inline-start:initial;max-width:100%;direction:var(--direction)}@media all and (max-width:1025px){.filters{flex-direction:column}ha-date-range-picker{margin-right:0;margin-inline-end:0;width:100%}}.start-search{padding-top:16px;text-align:center;color:var(--secondary-text-color)}"])))]}}]}}),(0,A.f)(D.oi));customElements.define("ha-panel-history",T)}}]);
//# sourceMappingURL=46305-Ybefzg0DI80.js.map